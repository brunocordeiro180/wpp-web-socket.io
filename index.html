<!doctype html>
<html>
  <head>
	<title>Socket.IO chat</title>
	<link rel="stylesheet" href="style.css">
  </head>
  <body>
	<div id="app">
		<div id="loading" >
			<img class="loaderAnimation" src="loader.svg">
		</div>

		<div class="isAuth" style="display: none;">
			<img src="check.svg">
			<p class="authTitle" >Você está autenticado!</p>
			<p>Em caso de erros, encerre a sessão e gere um novo QR Code</p>
			<button class="kill" onclick="kill();" >Encerrar</button>
		</div>
		<div class="code" >
			
		</div>

	</div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
  var socket = io("http://localhost:3333") // for latest version;

	if(localStorage.getItem("isConnected")){
		$('#loading').css("display", "none");
		$(".isAuth").css("display", "inline");
	}

	if(localStorage.getItem("base64Url") != "false"){
		$('#loading').css("display", "none");
		$(".code").html(`<p>Escaneie o <strong>QR Code</strong> abaixo para sincronizar</p><img src="${localStorage.getItem('base64Url')}" alt="">`);
		$(".isAuth").css("display", "none");
	}

	socket.on("paring", (base64Url) => {
		$('#loading').css("display", "none");
		$(".code").html(`<p>Escaneie o <strong>QR Code</strong> abaixo para sincronizar</p><img src="${base64Url}" alt="">`);
		$(".isAuth").css("display", "none");
		localStorage.setItem("base64Url", base64Url);
	})

	socket.on("success", () => {
		$('#loading').css("display", "none");
		$(".isAuth").css("display", "inline");
		$(".code").html("");
		localStorage.setItem("isConnected", true);
		localStorage.setItem("base64Url", false);
	})

	socket.on("isAuthenticated", () => {
		$('#loading').css("display", "none");
		$(".isAuth").css("display", "inline");
		$(".code").html("");
		localStorage.setItem("isConnected", true);
		localStorage.setItem("base64Url", false);
	})

	function kill() {
		$('#loading').css("display", "inline");
		$(".isAuth").css("display", "none");
		$(".code").html("");
		localStorage.setItem("isConnected", false);
		localStorage.setItem("base64Url", false);
		socket.emit('closeConnection')	
	}

</script>
</html>